' ############################################
' ---------------------------------------------
' create a req as an object with reduced number
' of attributes.
' Hint: objects are parts of class diagrams.
' in order to mix them or use them on other
' diagrams, "allowmixing" needs to be used.
!unquoted procedure _PUMLACreateReqObject($alias)
!$robjid=$alias+"_objid"
!if %not(%variable_exists($robjid))
' not sure why this is even working... addressing
' the $r object should not be possible here...
object $r.alias {
|= type | $r.type |
|= content | $r.content |
|= status  | $r.status |
}
%set_variable_value($robjid, "%true()")
!endif
!endprocedure

' ############################################
' ---------------------------------------------
' create the reqs trace starting with the
' requirement with the given alias in a
' recursive way with an iteration counter to
' make sure we do not consider elements up the
' trace, only down.
!unquoted procedure _PUMLARecursivePutReqsBreakdownTraceFor($alias, $itcnt, $parentalias)
!$r = null
!$cnt = %intval($itcnt)

!foreach $r in $allreqs.reqs
!if $r.alias == $alias
_PUMLACreateReqObject($r.alias)

' do not go the trace up on the first element, only down
!if %not($r.derived_from==null) && %not($cnt==0)
!foreach $drfr in $r.derived_from
!if $drfr==$parentalias
$drfr  <|-- $r.alias
!endif
!endfor
!endif

!$cnt = $cnt + 1
!if %not($r.derived_to==null)
!foreach $dtra in $r.derived_to
_PUMLARecursivePutReqsBreakdownTraceFor($dtra,$cnt, $alias)
!endfor
!endif

!endif
!endfor

!endprocedure


' ############################################
' ---------------------------------------------
' create the reqs trace starting with the
' requirement with the given alias in a
' recursive way.
!unquoted procedure PUMLAPutReqsBreakdownTraceFor($alias)
_PUMLARecursivePutReqsBreakdownTraceFor($alias,0, $alias)
!endprocedure



' ############################################
' ---------------------------------------------
' put a requirement with a given alias onto
' the diagram
!unquoted procedure PUMLAPutReq($alias)
!foreach $r in $allreqs.reqs
!if $r.alias == $alias
json $r.alias $r
!endif
!endfor
!endprocedure

' ############################################
' ---------------------------------------------
' put a requirement with reduced number of
' attributes for a given alias onto
' the diagram
!unquoted procedure PUMLAPutReqBrief($alias)
!foreach $r in $allreqs.reqs
!if $r.alias == $alias
_PUMLACreateReqObject($r.alias)
!endif
!endfor
!endprocedure

' ############################################
' ---------------------------------------------
' put a requirement with a given alias onto
' the diagram wrapped into a note
!unquoted procedure PUMLAPutReqAsNote($alias)
!foreach $r in $allreqs.reqs
!if $r.alias == $alias
    note as $r.alias #white
    {{
    PUMLAPutReqBrief($alias)
    }}
    end note
!endif
!endfor
!endprocedure

' ############################################
' ---------------------------------------------
' put all requirements with reduced number of
' attributes and trace onto the diagram
!unquoted procedure PUMLAPutAllReqsBrief()
!foreach $r in $allreqs.reqs
_PUMLACreateReqObject($r.alias)
!if %not($r.derived_from==null)
!foreach $drfr in $r.derived_from
$drfr <|-- $r.alias
!endfor
!endif
!endfor
!endprocedure
